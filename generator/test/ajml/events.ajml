<?xml version="1.0" encoding="UTF-8"?>
<ajml xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <application name="test" id="app">
    <events>
      <!-- 初期画面の設定-->
      <event target="root" type="display">
	<action>
	  <call element="root" func="selectPanel">
	    <param name="panel">
	      <string>entrance_room</string>
	    </param>
	  </call>
	</action>
      </event>
      <!-- 入室画面の初期化-->
      <event target="entrance_room" type="display">
	<action>
	  <!-- チャットルームの一覧の取得-->
	  <call element="roomSelect" func="load">
	    <param name="datum">
	      <select database="chatDB"/>
	    </param>
	  </call>
	</action>
      </event>
      <!-- チャットルーム画面の初期化-->
      <event target="chat_room" type="display">
	<action>
	  <!-- メッセージリストの取得-->
	  <call element="message_list" func="load">
	    <param name="datum">
	      <selectByCondition database="chatDB">
		<condition>
		  <eq>
		    <targetItem property="room_id"/>
		    <get element="roomSelect" property="value">
		      <param name="property">
			<string>id</string>
		      </param>
		    </get>
		  </eq>
		</condition>
	      </selectByCondition>
	    </param>
	  </call>
	</action>
      </event>
      <!-- 入室処理-->
      <event target="enterButton" type="Click">
	<action>
	  <insert database="chatDB">
	    <param name="user_name">
	      <get element="user_name_en" property="content"/>
	    </param>
	    <param name="enter_time"> 
	      <datetime value="0" />
	    </param>
	  </insert>
	</action>
      </event> 

      <!-- メッセージの送信-->
      <event target="submit" type="click">
	<action>
	  <insert id="insert_message" database="chatDB">
	    <param name="message">
	      <get element="message" property="value"/>
	    </param>
	    <param name="user_name"> 
	      <get element="user_name" property="value"/>
	    </param>
	    <param name="room_id">
	      <get element="room_select" property="value"/>
	    </param>
	    <param name="posted">
	      <datetime value="0"/>
	    </param>
	  </insert>
	  <branch>
	    <condition>
	      <success func_id = "insert_message">
	      </success>
	    </condition>
	    <then>
	    </then>
	    <else>
	    </else>
	  </branch>
	</action>
      </event>
      <!-- メッセージの変更を反映-->
      <event target="chatDB" type="insert">
	<condition>
	  <eq>
	    <targetItem property="room_id"/>
	    <get element="selectbox" property="selectedValue"/>
	  </eq>
	</condition>
	<action>
	  <call element="messageTable" func="insert">
	    <param name="user_name">
	      <receivedItem property="userName"/>
	    </param>
	    <param name="message">
	      <receivedItem property="message"/>
	    </param>
	    <param name="posted">
	      <receivedItem property="message"/>
	    </param>
	  </call>
	</action>
      </event>

    </events>
    
    <interfaces>
    </interfaces>
    <databases>
    </databases>
    
  </application>
</ajml>
